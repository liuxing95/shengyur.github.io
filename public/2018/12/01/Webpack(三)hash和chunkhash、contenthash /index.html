<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Webpack(三)—hash和chunkhash、chunkhash的使用场景与区别 | 往东</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Webpack(三)—hash和chunkhash、chunkhash的使用场景与区别</h1><a id="logo" href="/.">往东</a><p class="description">宁在一思进，莫在一思停。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Webpack(三)—hash和chunkhash、chunkhash的使用场景与区别</h1><div class="post-meta">Dec 1, 2018<span> | </span><span class="category"><a href="/categories/Tools/">效率工具</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack中hash和chunkhash有何不同？-contenthash"><span class="toc-number">1.</span> <span class="toc-text">webpack中hash和chunkhash有何不同？(contenthash)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#两者的使用"><span class="toc-number">1.1.</span> <span class="toc-text">两者的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hash和chunkhash是什么"><span class="toc-number">1.2.</span> <span class="toc-text">hash和chunkhash是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chunkhash是如何生成的"><span class="toc-number">1.3.</span> <span class="toc-text">chunkhash是如何生成的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#contenthash"><span class="toc-number">1.4.</span> <span class="toc-text">contenthash</span></a></li></ol></li></ol></div></div><div class="post-content"><h2 id="webpack中hash和chunkhash有何不同？-contenthash"><a href="#webpack中hash和chunkhash有何不同？-contenthash" class="headerlink" title="webpack中hash和chunkhash有何不同？(contenthash)"></a>webpack中hash和chunkhash有何不同？(contenthash)</h2><h3 id="两者的使用"><a href="#两者的使用" class="headerlink" title="两者的使用"></a>两者的使用</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用hash的情况</span></span><br><span class="line"><span class="attribute">output</span>: &#123;</span><br><span class="line">  <span class="attribute">path</span>: path.resolve(__dirname, <span class="string">'../dist/static'</span>),</span><br><span class="line">  <span class="attribute">publicPath</span>: <span class="string">'/'</span>,</span><br><span class="line">  <span class="attribute">filename</span>: <span class="string">'static/js/[name].[hash].js'</span>,</span><br><span class="line">  <span class="attribute">chunkFilename</span>: <span class="string">'static/js/[id].[hash].js'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用chunkhash的情况</span></span><br><span class="line"><span class="attribute">output</span>: &#123;</span><br><span class="line">  <span class="attribute">path</span>: config.prod.assetsRoot,</span><br><span class="line">  <span class="attribute">filename</span>: <span class="string">'static/js/[name]-[chunkhash:16].js'</span>,</span><br><span class="line">  <span class="attribute">chunkFilename</span>: <span class="string">'static/js/[id]-[chunkhash:16].js'</span>,</span><br><span class="line">  <span class="attribute">publicPath</span>: <span class="string">'/'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="hash和chunkhash是什么"><a href="#hash和chunkhash是什么" class="headerlink" title="hash和chunkhash是什么"></a>hash和chunkhash是什么</h3><p>大家都知道，用于优化页面性能的常用方法就是利用浏览器的缓存，文件的hash值，就相当于一个文件的身份证一样，很适用于前端静态资源的版本管理，前端实现增量更新的方案之一，那为什么会有两个东西呢，先看两者的定义</p>
<ul>
<li>hash</li>
</ul>
<p>[hash] is replaced by the hash of the compilation.<br>compilation的hash值</p>
<ul>
<li>chunkhash<br>[chunkhash] is replaced by the hash of the chunk.<br>chunk的hash值<br>后者很容易理解，因为chunk在webpack中的含义就是模块，那么chunkhash根据定义来就是<strong>根据模块内容计算出来的hash值</strong>。<br>在理解前者之前我们先来看一下compilation有什么作用</li>
</ul>
<p><strong>compilation的浅析</strong></p>
<p>webpack的官网文档中HOW TO WRITE A PLUGIN中对这个有一段文字的解析</p>
<blockquote>
<p>A compilation object represents a single build of versioned assets. While running Webpack development middleware, a new compilation will be created each time a file change is detected, thus generating a new set of compiled assets. A compilation surfaces information about the present state of module resources, compiled assets, changed files, and watched dependencies. The compilation also provides many callback points at which a plugin may choose to perform custom actions.</p>
</blockquote>
<p>翻译：</p>
<blockquote>
<p>compilation对象代表某个版本的资源对应的编译进程，当你跑webpack的development中间件，每当检测到一个文件被更新之后，一个新的comilation对象会被创建，从而引起新的一系列的资源编译。一个compilation含有关于模块资源的当前状态、被编译的资源，改变的文件和监听依赖的表面信息。compilation也提供很多回调方法，在一个插件可能选择执行制定操作的节点</p>
</blockquote>
<p>而与compilation对应的还有一个compiler对象，我们也来介绍一下，这样能够更方便理解compilation</p>
<blockquote>
<p>The compiler object represents the fully configured Webpack environment. This object is built once upon starting Webpack, and is configured with all operational settings including options, loaders, and plugins. When applying a plugin to the Webpack environment, the plugin will receive a reference to this compiler. Use the compiler to access the main Webpack environment.</p>
</blockquote>
<p>翻译：</p>
<blockquote>
<p>compiler对象代表的是整个webpack的配置环境，这个对象只在webpack开始的时候构建一次，且所有的操作设置包括options，loaders，plugin都会被配置，当在webpack中应用插件时，这个插件会接受这个compiler对象的引用。通过webpack的主环境去使用这个compiler。</p>
</blockquote>
<p>简单的说，compiler是针对webpack的，是不变的webpack环境，而compilation这个就是每次有一个文件更新，然后会重新生成一个，那么当你一个文件的更新，所有的hash字段都会发生变化，这就很坑了，本来我们做增量更新就是想改的那个文件发生变化，但是如果全部都发生变化就没有意义了，我们来看一下实际操作中的例子：<br><img src="https://raw.githubusercontent.com/shengyur/Images/master/img/webpack/hashOutput.png" alt="hashoutput1"><br><img src="https://raw.githubusercontent.com/shengyur/Images/master/img/webpack/hashoutput2.png" alt="hashoutput2"></p>
<p>而且从上图中可以看出，每次有文件更新，会产生一个新的compilation，从而会用新的compilation来计算得出新的hash，而且每个文件带有的hash值还是一样的，这样的肯定达不到我们的要求，那么如何避免这个问题呢？——chunkhash</p>
<h3 id="chunkhash是如何生成的"><a href="#chunkhash是如何生成的" class="headerlink" title="chunkhash是如何生成的"></a>chunkhash是如何生成的</h3><p>chunkhash是由chunk计算的得出的hash值，chunk指的是模块，这个hash值就是模块内容计算出来的hash值<br>修改单个文件前的chunkhash:<br><img src="https://raw.githubusercontent.com/shengyur/Images/master/img/webpack/chunkhash2.png" alt=""></p>
<p>修改后的文件的chunkhash<br><img src="https://raw.githubusercontent.com/shengyur/Images/master/img/webpack/chunkhash22.png" alt=""></p>
<p>这里我们还得提一个问题，比如像vue这些框架，把js和css共同放在一个里面会时，我们一般会用一个插件叫extract-text-webpack-plugin/mini-css-extract-plugin，这样我们就能把css单独打成一个包，但是这样就会产生一个问题，这样打包出来的css的chunkhash和js的chunkhash会不会是一样的呢，其实我这么问了，当然是会的啦。</p>
<p>其实也很简单，webpack的理念就是为了js的打包，style标签也会视为js的一部分，那么这我们会发现，还是有坑，当我们只改css的时候，js也会同时发生改变，那么我们还是没有做到严格意义上的增量更新，那么我们又该怎么解决呢？</p>
<h3 id="contenthash"><a href="#contenthash" class="headerlink" title="contenthash"></a>contenthash</h3><p>使用方式如下：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">new</span> <span class="selector-tag">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">            <span class="attribute">filename</span>: <span class="string">'[name].[chunkhash:8].css'</span></span><br><span class="line">          &#125;)</span><br></pre></td></tr></table></figure></p>
<p>这样就可以实现资源的合理跟新了</p>
<p>参考：<br><a href="https://blog.csdn.net/bubbling_coding/article/details/81561362" target="_blank" rel="noopener">https://blog.csdn.net/bubbling_coding/article/details/81561362</a><br><a href="https://github.com/laihuamin/JS-total/issues/19" target="_blank" rel="noopener">https://github.com/laihuamin/JS-total/issues/19</a></p>
</div><div class="tags"><a href="/tags/Webpack/">Webpack</a></div><div class="post-nav"><a class="next" href="/2018/11/11/谈谈Event Loop中(Job queue)任务队列的执行顺序/">谈谈Event Loop中(Job queue)任务队列的执行顺序</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://yoursite.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Nodejs/">Nodejs</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/人间不值得/">人间不值得</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/">前端基础</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JsTest/">前端自动化测试</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Questions/">十万个为什么</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/小算法/">小算法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frame/">库/框架</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/性能优化/">性能优化</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术思想/">技术思想</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">效率工具</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Analysis/">源码浅析</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/YAML/" style="font-size: 15px;">YAML</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/Sass/" style="font-size: 15px;">Sass</a> <a href="/tags/性能/" style="font-size: 15px;">性能</a> <a href="/tags/CDN/" style="font-size: 15px;">CDN</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/Jest/" style="font-size: 15px;">Jest</a> <a href="/tags/Nodejs/" style="font-size: 15px;">Nodejs</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/diff算法/" style="font-size: 15px;">diff算法</a> <a href="/tags/Javascript/" style="font-size: 15px;">Javascript</a> <a href="/tags/Webpack/" style="font-size: 15px;">Webpack</a> <a href="/tags/XMLHttpRequest/" style="font-size: 15px;">XMLHttpRequest</a> <a href="/tags/ES5/" style="font-size: 15px;">ES5</a> <a href="/tags/axios/" style="font-size: 15px;">axios</a> <a href="/tags/HTML/" style="font-size: 15px;">HTML</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/jQuery源码/" style="font-size: 15px;">jQuery源码</a> <a href="/tags/Less/" style="font-size: 15px;">Less</a> <a href="/tags/vscode/" style="font-size: 15px;">vscode</a> <a href="/tags/mock/" style="font-size: 15px;">mock</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/安全/" style="font-size: 15px;">安全</a> <a href="/tags/Node/" style="font-size: 15px;">Node</a> <a href="/tags/函数式编程/" style="font-size: 15px;">函数式编程</a> <a href="/tags/Event-lop/" style="font-size: 15px;">Event lop</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/01/Webpack(三)hash和chunkhash、contenthash /">Webpack(三)—hash和chunkhash、chunkhash的使用场景与区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/11/谈谈Event Loop中(Job queue)任务队列的执行顺序/">谈谈Event Loop中(Job queue)任务队列的执行顺序</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/04/Webpack(二)工作原理浅析/">Webpack(二)——工作原理浅析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/03/Webpack(一)入门实践与优化配置/">Webpack(一)——入门实践与优化配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/浏览器解析渲染过程解析/">浏览器解析渲染过程解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/20/chrome原生input框的自动补全如何关闭？/">chrome原生input框的自动补全如何关闭？</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/08/和固定，求两项（难度：★）/">和固定，求两项（难度：★）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/26/为什么git经常无法提交？/">为什么git经常无法提交？</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/21/性能优化工具分析/">常用前端性能优化工具分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/21/curl命令怎么使用的？/">curl命令是怎么使用的？</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.haomwei.com/technology/maupassant-hexo.html" title="大道至简——Hexo简洁主题推荐" target="_blank">大道至简——Hexo简洁主题推荐</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">往东.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>