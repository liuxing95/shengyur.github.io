title: 对象与数组的深浅拷贝
date: 2018/06/13
categories: 前端基础
toc: true
tags:
  - Javascript
---
<!-- <img src="https://pic2.zhimg.com/80/v2-e79fc1f234a9b78d4241e3187dffa11b_hd.jpg" style="width:56%"></img> -->


使用场景：

引用类型（Object, Array, Function, Date, Math, RegExp, Error）指的是那些保存在堆内存中的对象，变量中保存的实际上只是一个指针，这个指针指向内存中的另一个位置，由该位置保存对象。

当在实际开发中，如果使用 = 来给引用类型的数据赋值，由于指向的都是同一个对象，所以会修改原对象。于是需要拷贝一个副本，对副本进行数据操作
<!--more-->

## Javascript中的深拷贝与浅拷贝为什么会有区别？
对于这个问题，可以考虑从深拷贝和浅拷贝的使用或者起源说起，也就是为什么会出现这个问题。

首先了解一些javascript的基本知识。
### 1.javascript变量包含两种不同数据类型的值：基本类型和引用类型。
**基本类型** 值指的是简单的数据段，包括es6里面新增的一共是有6种，具体如下：

number、string、boolean、null、undefined、symbol

**引用类型** 值指那些可能由多个值构成的对象，只有一种如下：

object（Array也属于对象）

在将一个值赋给变量时，解析器必须确定这个值是基本类型值还是引用类型值。基本数据类型是按值访问的，因为可以操作保存在变量中的实际的值。

引用类型的值是保存在内存中的对象。与其他语言不同，**JavaScript 不允许直接访问内存中的位置，也就是说不能直接操作对象的内存空间。 在操作对象时， 实际上是在操作对象的引用而不是实际的对象。**

### 2.javascript的变量的存储方式--栈（stack）和堆（heap）
**栈** ：自动分配内存空间，系统自动释放，里面存放的是基本类型的值和引用类型的地址
**堆** ：动态分配的内存，大小不定，也不会自动释放。里面存放引用类型的值。
a. 基本类型--名值存储在栈内存中，例如let a=1;call

b.引用数据类型--名存在栈内存中，值存在于堆内存中，但是栈内存会提供一个引用的地址指向堆内存中的值，我们以上面浅拷贝的例子画个图：


<!-- <img src="https://pic2.zhimg.com/80/v2-e79fc1f234a9b78d4241e3187dffa11b_hd.jpg"></img> -->
### 3.javascript值传递与址传递
基本类型与引用类型最大的区别实际就是 **传值与传址的区别**
值传递：基本类型采用的是值传递。每次为基本类型赋值时，改变的就是当前值本身。
址传递：引用类型则是地址传递，将存放在栈内存中的地址赋值给接收的变量。每次使用=为引用类型赋值时，改变的是把新对象指向的地址值指向旧对象的地址值。

所以当
```
var obj={};
var newObj=obj;
newObj={"name":"shengyu"}
```
时候，打印出obj的值，会发现obj的值与newObj一起被修改了

那么如何解决上面出现的问题，就是使用浅拷贝或者深拷贝了。

## 什么是深拷贝/浅拷贝？
本文认为
浅拷贝：浅拷贝是复制引用，复制后的引用都是指向同一个对象的实例，**彼此之间的操作会互相影响**。

深拷贝：深拷贝不是简单的复制引用，而是在堆中重新分配内存，并且把源对象实例的所有属性都进行新建复制，以保证深复制的对象的引用图不包含任何原有对象或对象图上的任何对象，复制后的对象与原来的对象 **是完全隔离的**。
由深复制的定义来看，深复制要求如果源对象存在对象属性，那么需要进行递归复制，从而 **保证复制的对象与源对象完全隔离** 。然而，*还有一种可以说处在浅复制和深复制的粒度之间，也是jQuery的extend方法在deep参数为false时所谓的“浅复制”，这种复制只进行一个层级的复制：即如果源对象中存在对象属性，那么复制的对象上也会引用相同的对象。这不符合深复制的要求，但又比简单的复制引用的复制粒度有了加深*。


原文：
1. [快速浅拷贝一个数组](https://blog.csdn.net/yiifaa/article/details/73438088)
2. https://www.zhihu.com/question/23031215
3. [推荐！](https://www.cnblogs.com/tracylin/p/5346314.html)
4. [JavaScript复制（合并）对象](https://segmentfault.com/a/1190000011492291)
5. [ES6之扩展运算符与应用](https://www.jianshu.com/p/35f9efe95fff)
